//---------------------------------------------------------------------------

#include <windows.h>
#include <fmx.h>
#pragma hdrstop

#include "prototype.h"
#include "Unit2.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.fmx"
TForm1 *Form1;
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------

//Will check whether username or password in db
//If so, will complete login
//If not, will display error message
void __fastcall TForm1::loginSubmitButtonClick(TObject *Sender)
{
	//query the db for username and password
	SQLQuery1->SQL->Text="select * from user_info where username='"+usernameEdit->Text+"' and password=md5('"+passwordEdit->Text+"');";
	SQLQuery1->Open();
	SQLQuery1->First();

	//check if empty return or not
	if(!SQLQuery1->Eof)
	{
		//success (not empty), spawn next form, get rid of error message
		//first save some variables about the user
		errorLabel->Visible = false;
		username = usernameEdit->Text;
		password = passwordEdit->Text;
		inputLevel = SQLQuery1->Fields->Fields[9]->AsString;
		readLevel = SQLQuery1->Fields->Fields[8]->AsString;
		accessLevel = SQLQuery1->Fields->Fields[4]->AsString;
		userID = SQLQuery1->Fields->Fields[0]->AsString;

		//spawn the next form
		Form2->Show();

		//just checking to see if this has to close before the stuff in form5 can open
		SQLQuery1->Close();
		SQLConnection1->Close();
	}
	else
	{
		//failure, alert user to incorrect entry
		errorLabel->Visible = true;

		//add glow effect to empty edit text boxes
		if (usernameEdit->Text == "")
			usernameGlowEffect->Enabled = true;
		else
			usernameGlowEffect->Enabled = false;

		if (passwordEdit->Text == "")
			passwordGlowEffect->Enabled = true;
		else
			passwordGlowEffect->Enabled = false;
	}
}
//---------------------------------------------------------------------------

//Opens browser with registration form when register button clicked (still need to create form)
void __fastcall TForm1::loginregisterButtonClick(TObject *Sender)
{
	ShellExecute(NULL, L"open", L"http://baldwinserver.com/Lunaflare/generateKey.php", NULL, NULL, SW_SHOWNORMAL);
}
//---------------------------------------------------------------------------

//Opens browser with recover password form when register button clicked (still need to create form)
void __fastcall TForm1::recoverPasswordButtonClick(TObject *Sender)
{
	ShellExecute(NULL, L"open", L"http://baldwinserver.com/Lunaflare/generateKey.php", NULL, NULL, SW_SHOWNORMAL);
}
//---------------------------------------------------------------------------

